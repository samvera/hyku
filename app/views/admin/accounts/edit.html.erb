<% content_for :page_header do %>
  <h1><span class="fa fa-gears"></span> Editing Account</h1>
<% end %>
<div class="row">
  <div class="col-md-12">
    <div class="card account-form">
      <%= simple_form_for([:admin, @account], url: admin_account_path, :html => { class: 'form' }) do |f| %>
        <div class="card-body">
          <% if @account.errors.any? %>
            <div id="error_explanation" class="alert alert-danger alert-dismissible fade show" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              <h4 class="alert-heading">
                <i class="fa fa-exclamation-triangle mr-2"></i>
                <%= pluralize(@account.errors.count, "error") %> prohibited this account from being saved:
              </h4>
              <ul class="mb-0">
                <% @account.errors.messages.each do |key, messages| %>
                  <li class="mb-1">
                    <strong><%= key.to_s.humanize %>:</strong> 
                    <code class="text-danger">&quot;<%= @account.errors.details[key].first[:value] %>&quot;</code> 
                    <% if key.to_s == 'google_analytics_id' %>
                      <span class="text-danger">must be a valid Google Analytics 4 Measurement ID (e.g., G-XXXXXXXXXX)</span>
                    <% else %>
                      <span class="text-danger"><%= messages.join(' and ') %></span>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            </div>
          <% end %>
          <div class="form-group">
            <%= f.label :tenant %><br>
            <%= f.text_field :tenant, class: 'form-control', readonly: @account.persisted? %>
          </div>
          <% is_superadmin = current_ability.superadmin? %>
          <% settings = current_account.public_settings(is_superadmin: is_superadmin) %>
          
          <!-- Google Analytics Settings Section -->
          <% if settings.key?(:analytics) || settings.key?(:google_analytics_id) || settings.key?(:google_analytics_property_id) %>
            <%= render 'shared/google_analytics_settings', f: f, settings: settings %>
          <% end %>

          <!-- Other Settings -->
          <% settings.except(:analytics, :google_analytics_id, :google_analytics_property_id).each do |key, value| %>
            <%= render 'shared/settings', f: f, key: key, value: value %>
          <% end %>
          <div class="card-footer">
            <%= f.submit class: 'btn btn-secondary float-right' %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>